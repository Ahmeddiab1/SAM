#include <iostream>
#include <sstream>
#include <fstream>

#include <ssc/sscapi.h>

#include "export_config.h"
#include "startup_extractor.h"
#include "input_page_extractor.h"

int main(int argc, char *argv[]){
    if (argc != 1){
        std::cout << "startup.lk script file required.\n";
        return 1;
    }

    const std::string& filename = "/Users/dguittet/SAM-Development/sam/deploy/runtime/startup.lk";
    std::ifstream ifs(filename.c_str());
    if(!ifs.is_open()){
        std::cout << "cannot open file";
        return 1;
    }
    std::string content = static_cast<std::stringstream const&>(std::stringstream() << ifs.rdbuf()).str();

    std::vector<std::string> errors;

    startup_extractor su_e;
    su_e.load_startup_script(content, &errors);

    std::cout << "\"\"\"\n";
    std::cout << "\tFile generated by export_config.cpp. Do not edit directly.\n";
    std::cout << "\tSSC Version: " << ssc_version() << "\n";
    time_t now = time(0);
    std::cout << "\tDate: " << ctime(&now) <<"\n";
    std::cout << "\"\"\"\n\n";
    su_e.print_config_to_input();
    su_e.print_config_to_modules();
}

