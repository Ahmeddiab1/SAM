Fuel Cell
967
976
34
Divider

1
9
Name
5
11
Degradation
X
3
645
Y
3
150
Width
3
195
Height
3
16
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
11
Degradation
Bold
2
1
Divider

1
9
Name
5
16
Dynamic Response
X
3
393
Y
3
153
Width
3
195
Height
3
16
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
16
Dynamic Response
Bold
2
1
GroupBox

1
7
Name
5
17
Stack Replacement
X
3
9
Y
3
306
Width
3
950
Height
3
144
Caption
5
17
Stack Replacement
Bold
2
1
GroupBox

1
7
Name
5
11
fuelCellBox
X
3
6
Y
3
9
Width
3
950
Height
3
103
Caption
5
14
Fuel Cell Type
Bold
2
1
GroupBox

1
7
Name
5
12
fuelCellBox2
X
3
6
Y
3
117
Width
3
950
Height
3
187
Caption
5
17
System Properties
Bold
2
1
GroupBox

1
7
Name
5
12
fuelCellBox3
X
3
9
Y
3
450
Width
3
950
Height
3
349
Caption
5
10
Efficiency
Bold
2
1
GroupBox

1
7
Name
5
12
fuelCellBox4
X
3
9
Y
3
804
Width
3
950
Height
3
163
Caption
5
15
Fuel Properties
Bold
2
1
Label

1
12
Name
5
17
fuelCellFuelLabel
X
3
384
Y
3
828
Width
3
522
Height
3
105
Caption
5
353
Different fuel types may not be compatible will all fuel cell technologies or may require additional system components to convert the fuel into usable hydrogen.  Selecting a fuel type in SAM simply modifies default values for the lower heating value and price, making the assumption that the user understands the fuel input limitations for their system.
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Label

1
12
Name
5
17
fuelCellTypeLabel
X
3
312
Y
3
27
Width
3
615
Height
3
66
Caption
5
320
Modifying the fuel cell type changes default information about the system size, dynamic response, degradation and efficiency.  SAM models all fuel cell types the same way, by applying an electrical efficiency based upon the percent of max power at each timestep and limiting operation based upon dynamic response limits.
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Numeric

1
16
Name
5
26
fuelcell_degradation_input
X
3
750
Y
3
171
Width
3
54
Height
3
24
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
16
Name
5
28
fuelcell_degradation_restart
X
3
750
Y
3
198
Width
3
54
Height
3
24
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Choice

1
8
Name
5
26
fuelcell_degradation_units
X
3
810
Y
3
171
Width
3
78
Height
3
24
Items
6
2
kW/hr
%/year
Selection
3
4294967295
TabOrder
3
4294967295
Numeric

1
16
Name
5
25
fuelcell_dynamic_response
X
3
495
Y
3
207
Width
3
57
Height
3
24
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
DataMatrix

1
22
Name
5
19
fuelcell_efficiency
X
3
24
Y
3
474
Width
3
514
Height
3
300
PasteAppendRows
2
0
PasteAppendCols
2
0
ShowRows
2
1
ShowRowLabels
2
0
RowLabels
5
0
ShadeR0C0
2
0
ShadeC0
2
0
ShowCols
2
0
ShowColLabels
2
1
ColLabels
5
57
% Power, Electrical Efficiency LHV (%), Max Heat Recovery
NumRowsLabel
5
5
Rows:
NumColsLabel
5
5
Cols:
Layout
3
1
ChoiceColumn
3
4294967295
Choices
5
15
Choice1,Choice2
HideColumn
3
4294967295
ShowColumn
3
4294967295
Plot

1
5
Name
5
24
fuelcell_efficiency_plot
X
3
543
Y
3
474
Width
3
400
Height
3
300
Numeric

1
16
Name
5
26
fuelcell_fuel_available_in
X
3
171
Y
3
924
Width
3
90
Height
3
24
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Choice

1
8
Name
5
29
fuelcell_fuel_available_units
X
3
264
Y
3
924
Width
3
90
Height
3
24
Items
6
4
L
kg
m3
MCf
Selection
3
4294967295
TabOrder
3
4294967295
CheckBox

1
8
Name
5
21
fuelcell_fuel_limited
X
3
171
Y
3
894
Width
3
90
Height
3
24
Caption
5
0
State
2
0
TabOrder
3
4294967295
Choice

1
8
Name
5
18
fuelcell_fuel_type
X
3
171
Y
3
837
Width
3
90
Height
3
24
Items
6
4
Natural Gas
Diesel
Hydrogen
Custom
Selection
3
4294967295
TabOrder
3
4294967295
Numeric

1
16
Name
5
15
fuelcell_lhv_in
X
3
171
Y
3
867
Width
3
90
Height
3
24
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Choice

1
8
Name
5
18
fuelcell_lhv_units
X
3
264
Y
3
867
Width
3
90
Height
3
24
Items
6
3
Btu/lbm
MJ/kg
Btu/ft3
Selection
3
4294967295
TabOrder
3
4294967295
Numeric

1
16
Name
5
24
fuelcell_number_of_units
X
3
153
Y
3
222
Width
3
57
Height
3
24
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
16
Name
5
18
fuelcell_power_min
X
3
153
Y
3
276
Width
3
57
Height
3
24
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
16
Name
5
24
fuelcell_power_nameplate
X
3
153
Y
3
249
Width
3
57
Height
3
24
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Label

1
12
Name
5
26
fuelcell_replacement_label
X
3
654
Y
3
381
Width
3
251
Height
3
50
Caption
5
57
Enter a 1 to replace fuel cell stack in each year desired
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
RadioChoice

1
10
Name
5
27
fuelcell_replacement_option
X
3
60
Y
3
336
Width
3
219
Height
3
76
Selection
3
0
Items
6
3
No replacements
Replace at specified capacity
Replace at specified schedule
ShowCaptions
2
1
Horizontal
2
0
TabOrder
3
4294967295
Numeric

1
16
Name
5
28
fuelcell_replacement_percent
X
3
582
Y
3
342
Width
3
54
Height
3
24
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
DataArray

1
9
Name
5
29
fuelcell_replacement_schedule
X
3
549
Y
3
381
Width
3
90
Height
3
24
Mode
3
2
Label
5
33
Battery bank replacement schedule
Description
5
93
Battery bank replacement schedule (enter a 1 for years in which a battery replacement occurs)
TabOrder
3
4294967295
Numeric

1
16
Name
5
21
fuelcell_startup_time
X
3
495
Y
3
180
Width
3
57
Height
3
24
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Choice

1
8
Name
5
13
fuelcell_type
X
3
42
Y
3
48
Width
3
219
Height
3
27
Items
6
4
Molten carbonate (MCFC)
Phosphoric acid (PAFC)
Solid oxide (SOFC)
Custom
Selection
3
4294967295
TabOrder
3
4294967295
Numeric

1
16
Name
5
23
fuelcell_unit_max_power
X
3
153
Y
3
168
Width
3
57
Height
3
24
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
16
Name
5
29
fuelcell_unit_min_power_input
X
3
153
Y
3
195
Width
3
57
Height
3
24
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Choice

1
8
Name
5
23
fuelcell_unit_min_units
X
3
216
Y
3
195
Width
3
129
Height
3
24
Items
6
2
kW
% of nameplate
Selection
3
4294967295
TabOrder
3
4294967295
Divider

1
9
Name
5
9
object 21
X
3
51
Y
3
153
Width
3
195
Height
3
16
Orientation
3
0
Colour
4
120
120
120
255
Caption
5
4
Size
Bold
2
1

26
fuelcell_degradation
3
1
Degradation
kW/hour
Fuel Cell
0
8
1
1
1
1
0.01
Numeric
fuelcell_degradation_input
3
1
Degradation
 
Fuel Cell
0
2
1
1
1
1
20
Numeric
fuelcell_degradation_restart
3
1
Restart degradation
kW
Fuel Cell
0
2
1
1
1
1
1
Numeric
fuelcell_degradation_units
3
1
 
 
Fuel Cell
12
kW/hr|%/year
0
1
1
1
1
1
Choice
fuelcell_dynamic_response
3
1
Response after startup
kW/h
Fuel Cell
0
2
1
1
1
1
0.5
Numeric
fuelcell_efficiency
3
3
Thermal and electrical efficiency
%
Fuel Cell
53
% Power| Electrical Efficiency %| Max Heat Recovery %
1
1
3
11
3
0 0 50 
16 21 50 
25 25 50 
34 32 50 
44 37 50 
53 42 50 
62 47 49 
72 50 48 
82 52 47 
90 52 46 
100 51 45 

DataMatrix
fuelcell_fuel_available
3
1
Quantity available
 MCF
Fuel Cell
0
8
1
1
1
1
10000
Numeric
fuelcell_fuel_available_in
3
1
Fuel available
 
Fuel Cell
0
2
1
1
1
1
1000
Numeric
fuelcell_fuel_available_units
3
1
Available fuel units
 
Fuel Cell
26
Liters|kg|cubic meters|Mcf
1
1
1
1
1
3
Choice
fuelcell_fuel_limited
3
1
Fuel limited on site
 
Fuel Cell
0
0
1
1
1
1
0
CheckBox
fuelcell_fuel_type
3
1
Fuel Type
 
Fuel Cell
34
Natural Gas|Diesel|Hydrogen|Custom
2
1
1
1
1
0
Choice
fuelcell_lhv
3
1
Lower Heating Value
Btu/ft3
Fuel Cell
0
8
1
1
1
1
1033
Numeric
fuelcell_lhv_in
3
1
Lower Heating Value
 MJ/kg
Fuel Cell
0
2
1
1
1
1
20267
Numeric
fuelcell_lhv_units
3
1
Lower heating value units
 
Fuel Cell
21
Btu/lbm|MJ/kg|Btu/ft3
1
1
1
1
1
2
Choice
fuelcell_number_of_units
3
1
Number of units
 
Fuel Cell
0
2
1
1
1
1
1
Numeric
fuelcell_power_min
3
1
Minimum system output
kW
Fuel Cell
0
8
1
1
1
1
0
Numeric
fuelcell_power_nameplate
3
1
Total system nameplate
kW
Fuel Cell
0
8
1
1
1
1
0
Numeric
fuelcell_replacement_option
3
1
Replacement option
 
Fuel Cell
75
No replacements|Replace at specified capacity|Replace at specified schedule
1
1
1
1
1
0
RadioChoice
fuelcell_replacement_percent
3
1
Fuel cell stack replacement threshold
%
Fuel Cell
0
2
1
1
1
1
50
Numeric
fuelcell_replacement_schedule
3
2
Fuel cell replacement schedule
 
Fuel Cell
0
0
1
2
1
1
0
DataArray
fuelcell_startup_time
3
1
Startup time
hours
Fuel Cell
0
2
1
1
1
1
24
Numeric
fuelcell_type
3
1
Fuel Cell Type
 
Fuel Cell
21
MCFC|PAFC|SOFC|Custom
3
1
1
1
1
0
Choice
fuelcell_unit_max_power
3
1
Unit nameplate 
kW
Fuel Cell
0
2
1
1
1
1
100
Numeric
fuelcell_unit_min_power
3
1
Minimum Unit Output
kW
Fuel Cell
0
8
1
1
1
1
20
Numeric
fuelcell_unit_min_power_input
3
1
Minimum unit output
 
Fuel Cell
0
2
1
1
1
1
20
Numeric
fuelcell_unit_min_units
3
1
 
 
Fuel Cell
17
kW|% of nameplate
0
1
1
1
1
1
Choice

2570
equations{ 'fuelcell_fuel_available'} = define(){
	liter_per_m3 = 1000;
	MCF_per_liter = 28316.846592;
	
	// natural gas
	kg_per_liter = 0.9/liter_per_m3; 
	
	// Diesel
	if (${fuelcell_fuel_type} == 1){
		kg_per_liter = 832/liter_per_m3;
	}
	else if (${fuelcell_fuel_type} == 2){
		kg_per_liter = 0.071; // http://www.airproducts.com/Products/Gases/gas-facts/conversion-formulas/weight-and-volume-equivalents/hydrogen.aspx
	} 
	
	fuel_available = ${fuelcell_fuel_available_in};
	
	// Convert L to MCF 
	if (${fuelcell_fuel_available_units} == 0){
		 fuel_available = fuel_available * MCF_per_liter;
	}
	// Convert kg to MCF
	else if (${fuelcell_fuel_available_units} == 1){
		 fuel_available = (fuel_available/ kg_per_liter) * MCF_per_liter;
	}
	// Convert m3 to MCF
	else if (${fuelcell_fuel_available_units} == 2){
		 fuel_available = fuel_available * liter_per_m3 * kg_per_liter * MCF_per_liter;
	}
	
	
	return fuel_available;
};


equations{ 'fuelcell_lhv'} = define(){
	lhv = ${fuelcell_lhv_in};
	kg_per_lb = 0.453592;
	btu_per_mj = 0.0011;
	
	// natural gas density: https://www.engineeringtoolbox.com/gas-density-d_158.html
	lb_per_ft3 = 0.44;
		
	// Diesel density: https://www.engineeringtoolbox.com/fuels-densities-specific-volumes-d_166.html
	if (${fuelcell_fuel_type} == 1){
		lb_per_ft3 = 54.6;
	}
	// Hydrogen: http://www.airproducts.com/Products/Gases/gas-facts/conversion-formulas/weight-and-volume-equivalents/hydrogen.aspx
	else if (${fuelcell_fuel_type} == 2){
		lb_per_ft3 = 1.0/192.0;
	}
	
	// https://www.eia.gov/totalenergy/data/monthly/pdf/sec13_5.pdf
	// Convert Btu/lbm to Btu/ft3 
	if (${fuelcell_lhv_units} == 0){
		lhv = lhv * lb_per_ft3;
	}
	// Convert MJ/kg to Btu/ft3
	else if (${fuelcell_lhv_units} == 1){
		lhv = lhv * kg_per_lb * btu_per_mj * lb_per_ft3;
	}
		
	return lhv;
};

equations{'fuelcell_degradation'} = define()
{
	degradation = ${fuelcell_degradation_input};
	
	// Convert %/year into kW/hr per unit
	if (${fuelcell_degradation_units}==1){
		degradation = degradation * ${fuelcell_unit_max_power} * 0.01/8760;
	}
	
	return degradation;
};

equations{'fuelcell_power_nameplate'} = define(){
	return (${fuelcell_unit_max_power} * ${fuelcell_number_of_units});
};

equations{'fuelcell_power_min'} = define(){
	return (${fuelcell_unit_min_power} * ${fuelcell_number_of_units});
};

equations{'fuelcell_unit_min_power'} = define()
{
	power_min = ${fuelcell_unit_min_power_input};
	
	// convert % to kW
	if (${fuelcell_unit_min_units} == 1){
		power_min = ${fuelcell_unit_max_power} * power_min * 0.01;
	}
	return power_min;

};

2842
on_load{'Fuel Cell'} = define() {
	on_change{'fuelcell_efficiency'}(); 
	on_change{'fuelcell_fuel_type'}();
	on_change{'fuelcell_replacement_option'}();
	on_change{'fuelcell_fuel_limited'}();
	
	check_fuel_limited();
	//plot_efficiency();
};

on_change{'fuelcell_fuel_limited'} = define(){
	check_fuel_limited();
};

on_change{'fuelcell_replacement_option'} = define(){
	enable('fuelcell_replacement_percent', value('fuelcell_replacement_option')==1);
	enable('fuelcell_replacement_schedule', value('fuelcell_replacement_option')==2);
};

on_change{'fuelcell_efficiency'} = define(){
	plot_efficiency();
};

on_change{'fuelcell_fuel_type'} = define(){
	type = value('fuelcell_fuel_type');
	lhv = value('fuelcell_lhv_in');
	//price = value('fuelcell_fuel_price_in');
	
	lhv_unit = value('fuelcell_lhv_units'); /* Btu/lbm, MJ/kg, Btu/ft3 */
	//price_unit = value('fuelcell_price_units'); /*$/MCf, $/MMBtu, $/gal */
	
	// Natural Gas 
	if (type == 0){
		lhv = 983;    // https://www.engineeringtoolbox.com/heating-values-fuel-gases-d_823.html
		//price = 8.73; //https://www.eia.gov/naturalgas/data.php#prices
		lhv_unit = 2;
		//price_unit = 0;
	}
	// Diesel 
	else if (type == 1){
		lhv = 19604; // (https://www.engineeringtoolbox.com/fuels-higher-calorific-values-d_169.html)
		//price = 3.317; // https://www.eia.gov/petroleum/gasdiesel/ 
		lhv_unit = 0;
		//price_unit = 2;
		
	}
	// Hydrogen
	else if (type == 2){
		lhv = 51591; // https://www.engineeringtoolbox.com/heating-values-fuel-gases-d_823.html)
		//price = 5.60; //https://cafcp.org/content/cost-refill
		lhv_unit = 2;
		//price_unit = 2;
	}
	// Custom
	else {
		lhv_unit = 2;
		//price_unit = 0;
	}
	
	value('fuelcell_lhv_in', lhv);
	//value('fuelcell_fuel_price_in', price);
	value('fuelcell_lhv_units', lhv_unit);
	//value('fuelcell_price_units', price_unit);
};


function plot_efficiency()
{
	setplot( 'fuelcell_efficiency_plot' );
	clearplot();
	
	fce = ${fuelcell_efficiency};
	for (i=0; i<#fce; i++) {
		powerPercent[i] = fce[i][0];
		electricalPercent[i] = fce[i][1];
		heatRecovery[i] = fce[i][2];
	}
			
	plot( powerPercent, electricalPercent, {'thick'=2, 'type'='line', 'color'='blue', 'series'='Electrical efficiency %'});
	plot( powerPercent, heatRecovery, {'thick'=2, 'type'='line', 'color'='red', 'series'='Max heat recovery %'});
	
	plotopt( {'title'='Efficiencies vs Power Load', 'legend'=true, 'legendpos'=[65,60]});
	axis( 'x1', {'label'='Power Load (%)', 'min'=0, 'max'=100});
	axis( 'y1', {'label'='Efficiency (%)', 'min'=0, 'max'=max(max(electricalPercent),max(heatRecovery))+10});
}

function check_fuel_limited()
{
	enable('fuelcell_fuel_available_in', value('fuelcell_fuel_limited'));
	enable('fuelcell_fuel_available_units', value('fuelcell_fuel_limited'));
	
	if (value('fuelcell_fuel_limited') == 0){
		value('fuelcell_fuel_available_in', 1e10);
	}
}